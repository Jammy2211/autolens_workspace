### SETUP ###

Before using the Cosma pipeline runner, we need to setup a workspace on Cosma on your home directory
('/cosma/home/durham/cosma_username'). Your home directory has a limited amount of hard-disk space, so it
is key that the parts of your laptop's workspace which store large amounts of data (e.g. the data and output folders)
are omitted from this workspace and stored somewhere else on Cosma.

To setup your cosma workspace, the following commands should work from a terminal:

1) ssh -X cosma_username@login.cosma.dur.ac.uk

   This command ssh's you into cosma, and should be something you're familiar with. It'll login you into your home
   directory ('/cosma/home/durham/cosma_username').

2) cp -r /cosma/home/durham/pdtw24/workspace .

   This command will copy my template cosma workspace from my cosma home directory to yours.

Now we need to setup your cosma environment so that it can run PyAutoLens.

module purge
module load python/3.6.5
source /cosma/home/durham/pdtw24/PyAutoLens/bin/activate

You will have to run the commands above every time you log into Cosma. To make this your default setup (e.g. if you're
only going to be using PyAutoLens on Cosma) you can add the lines above to your .bashrc file:

emacs -nw $HOME/.bashrc

then copy and paste the 3 commands above (module purge, module import, etc.) into this file.

Now, we need to setup the directories that we'll store our data and PyAutoLens output on cosma. Logged into cosma
(e.g. via ssh), type the following command to go to your data directory:

cd /cosma5/data/durham/cosma_username

Now, we'll make a directory 'autolens' to store all things PyAutoLens, and go into that directory.

mkdir autolens
cd autolens

Finally, we'll make our data and output folders, which we'll next transfer our data into.

mkdir data
mkdir output

### TRANSFERRING DATA ###

We are going to need to send files from your laptop to Cosma, and visa versa. On Cosma, the data and output files of
PyAutolens stored in a separate directory to the workspace, which can be found at the location
'/cosma5/data/durham/cosma_username/'. This is because the large amounts of data storage required on super
computer are kept in a separate location to your cosma home directory.

Thus, we need some neat tools that allow us to upload the data / output folders on our laptop to this directory on
Cosma, and conversely download the results of a PyAutoLens analysis on Cosma to our workspace. The command 'rsync'
has us covered, and we'll use 3 custom options of rsync:

1) --update, which only sends data which has been updated on your laptop / Cosma. Thus, it ensures we don't resend our
    entire data-set or set of results every time we perform a file transfer. Phew!

2) -v, this stands for verbose, and gives text output of the file transfer's progress.

3) -r, we'll send folders full of data rather than individual files, and this r allows us to send entire folders.

Before running rsync, you should navigate your command line to your laptop's PyAutoLens workspace.

cd /path/to/workspace

Now we're in our workspace, the following rsync commands can be used to send you data and output to Cosma:

### To upload data from your laptop to Cosma ###

rsync --update -v -r data cosma_username@login.cosma.dur.ac.uk:/cosma5/data/autolens/

### To upload output from your laptop to Cosma ###

rsync --update -v -r output/* cosma_username@login.cosma.dur.ac.uk:/cosma5/data/autolens/output_cosma_username/


The following commands will allow us to update cosma with our latest pipelines, which we'll run using the
pipeline_runner_cosma.py script (note that we're sending these to a different directory than the data / output above)

### To upload pipelines from your laptop to Cosma ###

rsync --update -v -r pipelines cosma_username@login.cosma.dur.ac.uk:/cosma/home/durham/cosma_username/workspace/

You may also need to update your cosma pipeline runner, or send some of your own runners!

### To upload runners from your laptop to Cosma ###

rsync --update -v -r runners/cosma/* cosma_username@login.cosma.dur.ac.uk:/cosma/home/durham/cosma_username/workspace/runners/

New versions of PyAutoLens often require new config files - I will notify you on SLACK when I update PyAutoLens on
Cosma and new configs must be updloaded to Cosma. Furtheremore, if you edit configs on your laptop to customize the
analysis, you will need to upload them to Cosma for them to be used.

rsync --update -v -r config cosma_username@login.cosma.dur.ac.uk:/cosma/home/durham/cosma_username/workspace/

The following rsync commands can be used to download your data and output from Cosma:

### To download data from Cosma to your laptop ###

rsync --update -v -r cosma_username@login.cosma.dur.ac.uk:/cosma5/data/autolens/data .

### To download output from Cosma to your laptop ###

rsync --update -v -r cosma_username@login.cosma.dur.ac.uk:/cosma5/data/autolens/output_cosma_username/* ./output/


Now you're setup, go to the 'pipeline_runner_cosma.py' file to learn about how we submit PyAutoLens jobs to Cosma.